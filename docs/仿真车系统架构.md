# 仿真车系统架构设计 

## 仿真车显示界面职能介绍： 

1. 负责请求注册，删除仿真车实例。 

2. 修改已注册的仿真车实例配置。 

3. 地图加载和显示，路径和站点详情展示。 

4. 接受仿真车上报的state，并根据state在前端地图渲染机器人，并在机器人列表中更新坐标，朝向，电量等信息。 

5. 能够通过键盘，经由API请求，对机器人进行简单的前后左右控制。 

6. 能够根据仿真车当前位置和目标站点，生成简单的order指令，通过MQTT广播给仿真车，使得仿真车能进行简单的站点导航。 



## 仿真车仿真器职能介绍（.py）： 

1. 拥有仿真车碰撞模块，用于判断多辆仿真车运行时是否可能发生碰撞。 

2. 拥有时间管理模块，可以加速或减速仿真车的运行速度，包括但不限于，运动速度，充电速度，耗电速度，动作执行速度，state发布速度等，以便于调整仿真实验的进程。 

3. 能够根据前端的请求创建和注销仿真车实例，并根据请求修改已注册的仿真车实例配置。 

4. 状态（state）管理模块，对于位置数据，载货状态，充电状态等进行实时写入，以及对当前state状态组合成符合VDA5050协议的数据格式进行定时发布。 

5. 任务（order）管理模块，对于order的接收，解析，校验等进行管理，将需要执行的order任务发送到对应的导航模块或动作管理模块。 

6. 连接（connection）管理模块，对于仿真车实例上线和下线发布MQTT消息。 

7. 物理信息（factsheet）管理模块，用于通过MQTT发布小车的物理信息声明，用于仿真车碰撞模块的碰撞识别。 

8. 动作（instantactions）管理模块，对于instantactions的接收，解析，校验等进行管理，将需要执行的instantactions任务发送到对应的动作执行模块。 

9. 导航模块，能够根据任务模块解析的导航任务，进行路线规划，包括直线路径规划，高阶贝塞尔曲线路径规划等。 

10. 动作执行模块，需要将仿真车的动作拆解为前进，后退，左转，右转，托盘上升，托盘下降，充电，货叉上升，货叉下降，托盘旋转等。将导航模块下发的导航指令使用运动动作进行执行，以及将动作管理模块解析的动作进行执行。 

11.地图管理模块，用于加载，解析地图数据。



## 项目文件目录

simulation-vehicle-system/
├── frontend/                          # 前端显示界面
│   ├── src/
│   │   ├── components/                # 可复用UI组件（如地图、机器人列表等）
│   │   ├── views/                     # 页面视图（注册、配置、地图展示等）
│   │   ├── services/                  # API请求服务（注册、控制、状态获取等）
│   │   ├── utils/                     # 工具函数（地图解析、坐标转换等）
│   │   └── assets/                    # 静态资源（图片、样式等）
│   ├── public/                        # 公共资源
│   └── package.json                   # 前端依赖配置
│
├── SimVehicleSys/                     # 仿真车仿真器（Python）
│   ├── sim_vehicle/                   # 仿真车核心模块
│   │   ├── __init__.py
│   │   ├── vehicle.py                 # 仿真车实例模型
│   │   ├── collision.py               # 碰撞检测模块
│   │   ├── time_manager.py            # 时间管理模块
│   │   ├── state_manager.py           # 状态管理模块（VDA5050格式）
│   │   ├── order_manager.py           # 任务管理模块
│   │   ├── connection_manager.py      # 连接管理模块（MQTT）
│   │   ├── factsheet_manager.py       # 实物信息管理模块
│   │   ├── instantactions_manager.py  # 即时动作管理模块
│   │   ├── navigation.py              # 导航模块（路径规划）
│   │   ├── action_executor.py         # 动作执行模块
│   │   └── map_manager.py             # 地图管理模块
│   ├── mqtt/                          # MQTT通信相关
│   │   ├── client.py                  # MQTT客户端
│   │   └── handlers.py                # 消息处理器
│   ├── api/                           # 前端调用接口
│   │   ├── app.py                     # Flask/FastAPI应用入口
│   │   ├── routes.py                  # 路由定义
│   │   └── controllers.py             # 控制器逻辑
│   ├── config/                        # 配置文件
│   │   ├── settings.py                # 系统配置
│   │   └── mqtt_config.py             # MQTT配置
│   ├── utils/                         # 工具函数
│   │   ├── logger.py                  # 日志配置
│   │   └── helpers.py                 # 通用辅助函数
│   └── requirements.txt               # Python依赖
│
├── maps/                              # 地图数据存储目录
│   ├── VehicleMap/                    # 车辆端地图
│   │   ├── test1.scene
│   │   ├── test2.scene
│   │   ├── test3.scene
│   │   └── test4.scene
│   └── ViewerMap/                     # 监控端地图
│       └── testmap.scene
│
├── docs/                              # 项目文档
│   ├── architecture.md                # 系统架构说明
│   ├── api.md                         # API接口文档
│   └── deployment.md                  # 部署指南
│
└── README.md                          # 项目说明